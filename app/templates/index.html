{% extends "base.html" %}

{% block title %}Forum{% endblock %}

{% block content %}

<button id="showAddPost">Add post +</button>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
      {% for msg in messages %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<div id="addPostModal" style="display:none;">
  <form method="POST" enctype="multipart/form-data" id="addPostForm">
    <h2>New post</h2>
    <label>Title:<br><input type="text" name="title" required></label><br>
    <label>Content:<br><textarea name="content" required></textarea></label><br>
    <label>Attach image:<br><input type="file" name="image" accept="image/*"></label><br>
    <button type="submit">Add post</button>
    <button type="button" id="hideAddPost">Cancel</button>
  </form>
</div>

<hr>

<h2>Posts</h2>
{% if hashtags %}
  <div>
    <b>Top hashtags:</b>
    {% for tag in hashtags %}
      <a href="/hashtag/{{ tag.name }}">#{{ tag.name }}</a>
    {% endfor %}
  </div>
{% endif %}

<ul>
{% for post in posts %}
    <li>
        <a href="/post/{{ post.id }}">{{ post.title }}</a><br>
        <small>added by: <a href="/users/{{ post.author.login }}">{{ post.author.login }}</a> | {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at else '' }}</small>
        {% if post.image_url %}
          <br>
          <img src="{{ post.image_url }}" alt="post image">
        {% endif %}
        <div class="post-content">
          <p>{{ post.content | parse_mentions | safe }}</p>
        </div>
        {% if post.hashtags %}
          <div>
            {% for tag in post.hashtags %}
              <a href="/hashtag/{{ tag.name }}">#{{ tag.name }}</a>
            {% endfor %}
          </div>
        {% endif %}
        <div class="reactions">
          <form action="{{ url_for('posts.react', post_id=post.id, reaction_type='plus') }}" method="post">
            <button type="submit" class="primary" {% if your_reactions[post.id] == 'plus' %}disabled{% endif %}>+
              {% if reactions_map[post.id]['plus'] > 0 %} {{ reactions_map[post.id]['plus'] }}{% endif %}
            </button>
          </form>
          <form action="{{ url_for('posts.react', post_id=post.id, reaction_type='minus') }}" method="post">
            <button type="submit" class="secondary" {% if your_reactions[post.id] == 'minus' %}disabled{% endif %}>-
              {% if reactions_map[post.id]['minus'] > 0 %} {{ reactions_map[post.id]['minus'] }}{% endif %}
            </button>
          </form>
        </div>
    </li>
{% endfor %}
</ul>

{% endblock %}