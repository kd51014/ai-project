{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<h1>{{ post.title }}</h1>

{% if session.user_id and current_user.is_admin %}
<form method="POST" action="{{ url_for('posts.delete_post', post_id=post.id) }}">
  <button class="secondary"
    onclick="return confirm('Delete this post?');">
    Delete
  </button>
</form>
{% endif %}

<p>
  <small>
    by 
    {% if post.author and post.author.login %}
      <a href="{{ url_for('users.profile', login=post.author.login) }}">{{ post.author.login }}</a>
    {% else %}
      <em>unknown</em>
    {% endif %}
    |
    {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at }}
  </small>
</p>

<div class="post-content">
  <p>{{ post.content | parse_mentions | safe }}</p>
</div>

{% if post.hashtags %}
  <p class="post-hashtags">
    {% for tag in post.hashtags %}
      <a href="{{ url_for('posts.posts_by_hashtag', name=tag.name) }}">#{{ tag.name }}</a>
      {% if not loop.last %} {% endif %}
    {% endfor %}
  </p>
{% endif %}

<div class="reactions">
  <form action="{{ url_for('posts.react', post_id=post.id, reaction_type='plus') }}" method="post">
    <button type="submit" class="primary" {% if your_reaction == 'plus' %}disabled{% endif %}>+
      {% if plus > 0 %} {{ plus }}{% endif %}
    </button>
  </form>

  <form action="{{ url_for('posts.react', post_id=post.id, reaction_type='minus') }}" method="post">
    <button type="submit" class="secondary" {% if your_reaction == 'minus' %}disabled{% endif %}>-
      {% if minus > 0 %} {{ minus }}{% endif %}
    </button>
  </form>
</div>

<hr>

<h2>Comments</h2>

<ul class="comments">
{% for comment in comments %}
  {% include "posts/_comment.html" %}
{% else %}
  <li>No comments yet.</li>
{% endfor %}
</ul>

{% if session.user_id %}
<hr>
<h3>Add a comment</h3>
<form method="POST">
  <textarea name="content" required></textarea><br>
  <button class="primary">Reply</button>
</form>
{% else %}
<p><a href="/auth/login">Log in</a> to comment.</p>
{% endif %}
{% endblock %}
