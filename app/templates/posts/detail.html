{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<article class="post-detail">
  <header>
    <h1>{{ post.title }}</h1>

    <div class="post-meta">
      {% if post.author %}
        <a href="{{ url_for('users.profile', login=post.author.login) }}">
          {{ post.author.login }}
        </a>
      {% else %}
        <em>unknown</em>
      {% endif %}
      â€¢ {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at }}
    </div>
	
	{% if post.image_url %}
		<img src="{{ post.image_url }}" alt="Post image" class="post-image">
	{% endif %}

    {% if session.user_id and current_user.is_admin %}
    <form method="POST" action="{{ url_for('posts.delete_post', post_id=post.id) }}">
      <button class="btn btn-danger"
        onclick="return confirm('UsunÄ…Ä‡ post?');">
        UsuÅ„
      </button>
    </form>
    {% endif %}
  </header>

  <div class="post-content">
    {{ post.content | parse_mentions | safe }}
  </div>

  {% if post.hashtags %}
  <div class="hashtags">
    {% for tag in post.hashtags %}
      <a href="{{ url_for('posts.posts_by_hashtag', name=tag.name) }}">
        #{{ tag.name }}
      </a>
    {% endfor %}
  </div>
  {% endif %}

  <div class="reactions">
    <form method="POST" action="{{ url_for('posts.react', post_id=post.id, reaction_type='plus') }}">
      <button class="btn btn-primary" {% if your_reaction == 'plus' %}disabled{% endif %}>
        ðŸ‘ {{ plus if plus > 0 }}
      </button>
    </form>

    <form method="POST" action="{{ url_for('posts.react', post_id=post.id, reaction_type='minus') }}">
      <button class="btn btn-secondary" {% if your_reaction == 'minus' %}disabled{% endif %}>
        ðŸ‘Ž {{ minus if minus > 0 }}
      </button>
    </form>
  </div>
</article>

<section class="comments-section">
  <h2>Komentarze</h2>

  <ul class="comments">
    {% for comment in comments %}
      {% include "posts/_comment.html" %}
    {% else %}
      <li class="empty">Brak komentarzy</li>
    {% endfor %}
  </ul>

  {% if session.user_id %}
  <form method="POST" class="comment-form">
    <textarea name="content" placeholder="Dodaj komentarz..." required></textarea>
    <button class="btn btn-primary">Dodaj</button>
  </form>
  {% else %}
    <p><a href="/auth/login">Zaloguj siÄ™</a>, aby komentowaÄ‡.</p>
  {% endif %}
</section>
{% endblock %}
